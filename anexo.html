<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Código | Script</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Consultoría BID</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Presentación</a>
</li>
<li>
  <a href="webscrapping.html">Trends</a>
</li>
<li>
  <a href="about.html">Academic Journals</a>
</li>
<li>
  <a href="demography.html">Demography</a>
</li>
<li>
  <a href="Bases-de-Datos.html">Bases de Datos</a>
</li>
<li>
  <a href="anexo.html">Código | Script </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Código | Script</h1>

</div>


<style type="text/css">
pre {
  max-height: 150px;
  overflow-y: auto;
  background-color: inherit;
}

pre[class] {
  max-height: 150px;
  overflow-y: auto;
  background-color: inherit;
}


</style>
<div id="rstudio" class="section level1">
<h1>1. Procesamiento en Rstudio</h1>
<p>Para la secuencia de comandos utilizados en el procesamiento de extracción de información, cálculo y visualización, se utilizó la versión de escritorio de Rstudio, que permite localmente obtener resultados de la sintaxis, codificación e indentación del código de R.</p>
<p>Siendo necesario añadir que previa instalación de Rstudio, se debe instalar entorno de ‘R’, que compila y ejecuta directamente el lenguaje R para Windows y/o para Rstudio. Ambos links se encuentran a continuación:</p>
<ul>
<li><p><a href="https://cran.r-project.org/bin/windows/base/">R</a> - HTML a la versión instalable y ejecutable de R 4.0.2.</p></li>
<li><p><a href="https://rstudio.com/products/rstudio/download/#download">Rstudio</a> - HTML a la descarga de la versión más reciente de Rstudio.)</p></li>
</ul>
</div>
<div id="gh" class="section level1">
<h1>2. Publicación en GitHub</h1>
<p>Actualmente estamos realizando la publicación de resultados y explicación del procesamiento de los datos, en GitHub. Al trabajar en Rstudio y GitHub nos permite desarrollar el procesamiento en un directorio local y luego cargarlo en línea. En tanto, el lenguaje utilizados para la construcción del sitio cuya salida es en HTML, es <a href="https://rmarkdown.rstudio.com/">Rmarkdown</a>, y la terminal del software de control de versiones es <a href="https://git-scm.com/">Git</a>.</p>
</div>
<div id="trends" class="section level1">
<h1>3. Trends</h1>
<p>En esta sección se explicará paso a paso el código, que permiten obtener los productos y gráficos de la sección <a href="webscrapping.html#resultados">resultados</a>.</p>
<div id="topics2019" class="section level2">
<h2>3.1Topics Over Time 2019</h2>
<div id="librerias" class="section level3">
<h3>3.1.1 Librerías</h3>
<p>En primer lugar, se deben ejecutar los siguientes paquetes mediante el comando ‘library’, una vez realizado este proceso, no es necesario hacerlo nuevamente.</p>
</div>
<div id="parameters" class="section level3">
<h3>3.1.2 Parameters</h3>
<p>Para la generación de los gráficos de la sección <a href="webscrapping.html#topics2019">Topics Over Time 2019</a>, en primer lugar se especifican los siguientes parámetros:</p>
<ul>
<li>‘terminos’: lista de términos de interés para la búsqueda.</li>
<li>‘topics_tbl’: Data Frame cuyo atributo ‘NULL’ implica que se genera sin ningún contenido, y posteriormente se completa secuencialmente, con la información arrojada tras la ejecución de la función ‘for’.</li>
<li>‘time’: Especifica el rango temporal de la búsqueda que en este caso es entre la fecha “2019-01-01” y “2019-07-01”.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb1-2"><a href="#cb1-2"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb1-3"><a href="#cb1-3"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a>topics_tbl=<span class="ot">NULL</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a>time=<span class="st">&quot;2019-01-01 2019-07-01&quot;</span></span></code></pre></div>
</div>
<div id="dataframe" class="section level3">
<h3>3.1.3 Dataframe</h3>
<p>En este punto, se define una iteraciòn para los elementos que componen la lista de ‘terminos’ en Google Trends. Esta iteración indica que para todos los elementos de la lista de ‘terminos’ busque los 10 valores más relacionados a la palabra clave buscada, así como el “número de apariciones que tiene”interés" que se tiene respecto a estos valores. De este modo, se formará un Dataframe con tres variables: “keyword”, “value” e “interest”. Siendo respectivamente “keyword” el equivalente del término buscado, “value” los valores asociados, e “interest” el parámetro estandarizado de Google Trends que varía de 1 a 100, indicando del valor menos buscado al más buscado.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb2-2"><a href="#cb2-2"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb2-3"><a href="#cb2-3"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb2-5"><a href="#cb2-5"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>        </span>
<span id="cb2-7"><a href="#cb2-7"></a>        n_term=<span class="dv">10</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>        top_n_related_topics_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="st">                </span><span class="kw">pluck</span>(<span class="st">&quot;related_topics&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="st">                </span><span class="kw">filter</span>(related_topics <span class="op">==</span><span class="st"> &quot;top&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(subject)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="st">                </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="st">                </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="st">                </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="st">                </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>n_term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="st">                </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb2-19"><a href="#cb2-19"></a>        </span>
<span id="cb2-20"><a href="#cb2-20"></a>        topics_tbl=<span class="st"> </span><span class="kw">union_all</span>(topics_tbl,top_n_related_topics_tbl)</span>
<span id="cb2-21"><a href="#cb2-21"></a>}</span></code></pre></div>
<p>Como ya mencionamos, por cada uno de los términos antes señalados, se buscaron los 10 valores más relacionados a la búsqueda. Para ejemplificar, haremos una selección de los 10 valores relacionados solo al termino “Violencia Doméstica”.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>VD &lt;-<span class="st"> </span><span class="kw">subset</span>(topics_tbl, keyword <span class="op">==</span><span class="st"> &quot;Violencia Domestica&quot;</span>) </span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">head</span>(VD)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   keyword             value             interest
##   &lt;chr&gt;               &lt;fct&gt;                &lt;dbl&gt;
## 1 Violencia Domestica Domestic violence      100
## 2 Violencia Domestica Violence                98
## 3 Violencia Domestica Woman                   18
## 4 Violencia Domestica Female                  17
## 5 Violencia Domestica Law                      9
## 6 Violencia Domestica Victim                   8</code></pre>
<p>De este modo, se observa una escala donde “Violence”, “Domestic Violence”, “Woman” y “Female” son los valores mayormente relacionados al término “violencia Doméstica”, no siendo raro que los dos primeros términos por defectos vengan dentro del término consultado, es posible apreciar que “Woman” y “Female” sí sean parte de los primeros valores relacionados.</p>
<p>Si replicaramos el ejercicio con los términos “Violencia contra la mujer” o “Violence Against Women”, los resultados son similares al anteriormente expuesto. Lo cual nos indica que en este caso, los términos muestran similitud en los valores relacionados a la consulta.</p>
</div>
<div id="data-manipulation" class="section level3">
<h3>3.1.4 Data Manipulation</h3>
<p>La siguiente sección corresponde al tratamiento que se realiza al agrupar los términos que están asociados a Cyberbullying o Violencia Doméstica respectivamente.</p>
<p>Siendo relevante señalar, que observando cada uno de los subconjuntos de valores correspondientes a cada término, es posible asegurar que en el caso de los términos “Ciberacoso”,“Ciberbullying” y “Cyberbullying”, pueden ser considerados como términos homólogos y por tanto, para abarcar una mayor amplitud del fenómeno es posible recodificarlos en un solo término denominado “Cyberbullying”.</p>
<p>Por otro lado, “Violencia Domestica”,“Violencia contra la mujer” y “Violence Against Women”, por la misma razón expuesta, serán considerados como homólogos y recodificados como “Violencia Doméstica”.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>topics_tbl=topics_tbl<span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,value) <span class="op">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_in=</span><span class="kw">max</span>(interest))<span class="op">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(max_in)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="st">        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="st">        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">head</span>(topics_tbl)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   keyword             value             interest
##   &lt;chr&gt;               &lt;fct&gt;                &lt;dbl&gt;
## 1 Cyberbullying       Cyberbullying          100
## 2 Cyberbullying       Cyberbullying          100
## 3 Cyberbullying       Cyberbullying          100
## 4 Violencia Doméstica Domestic violence      100
## 5 Violencia Doméstica Violence               100
## 6 Violencia Doméstica Violence               100</code></pre>
</div>
<div id="save-bbdd" class="section level3">
<h3>3.1.5 Save BBDD</h3>
<p>Es importante, indicar que si bien existe un rango temporal que en este caso corresponde a las fechas 2019-01-01" y “2019-07-01”, no es posible asegurar que debido a factores externos al desarrollo del Script, los resultados puedan variar, es por ello que es importante guardar los resultados cuando estime conveniente con la función ‘saveRDS’:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">saveRDS</span>(topics_tbl,<span class="st">&quot;topics_tbl19.rds&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#El formato RDS se utilizó para comprimir la información y ejecutarla en Rstudio. </span></span></code></pre></div>
</div>
<div id="read-bbdd" class="section level3">
<h3>3.1.6 Read BBDD</h3>
<p>Para rescatar el resultado previamente guardado, se ejecuta la función ‘readRDS’</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>topics_tbl =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;topics_tbl19.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="plot" class="section level3">
<h3>3.1.7 Plot</h3>
<p>Finalmente se ejecuta la representación gráfica para el año ‘2019’.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>topics=topics_tbl <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, interest, <span class="dt">color =</span> keyword)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> value, <span class="dt">yend =</span> <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">        </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">        </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">        </span><span class="kw">theme_tq</span>()<span class="op">+</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="st">        </span><span class="kw">scale_color_tq</span>()<span class="op">+</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;2019&quot;</span>)<span class="op">+</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb10-11"><a href="#cb10-11"></a>        </span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="kw">plot</span>(topics)</span></code></pre></div>
</div>
<div id="clear-objects-from-de-workspace" class="section level3">
<h3>3.1.8 Clear Objects from de workspace</h3>
<p>Es importante que al reutilizar los objetos, funciones y nombres, el ambiente de trabajo Rstudio sea borrado, más aún cuando se utiliza la función ‘union_all’ que en una iteración va agregando atributos al DataFrame. En este sentido, luego de generar el gráfico hemos utilizado la expresión que se indica a continuación:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span></code></pre></div>
</div>
</div>
<div id="aqueries2019" class="section level2">
<h2>3.2 Queries Over Time 2019</h2>
<div id="librerías" class="section level3">
<h3>3.2.1 Librerías</h3>
<p>En todo el proceso se ejecutan los mismo paquetes indicados en la sección <a href="#topics2019">Topics Over Time 2019</a> .</p>
</div>
<div id="parameters-1" class="section level3">
<h3>3.2.2 Parameters</h3>
<p>Para la generación de los gráficos de la sección <a href="webscrapping.html#queries2019">Queries Over Time 2019</a>, se mantienen los parámetros para el año 2019:</p>
<ul>
<li>‘terminos’: lista de términos de interés para la búsqueda.</li>
<li>‘topics_tbl’: Data Frame cuyo atributo ‘NULL’ implica que se genera sin ningún contenido, y posteriormente se completa secuencialmente, con la información arrojada tras la ejecución de la función ‘for’.</li>
<li>‘time’: Especifica el rango temporal de la búsqueda que en este caso es entre la fecha “2019-01-01” y “2019-07-01”.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb12-2"><a href="#cb12-2"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb12-3"><a href="#cb12-3"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>topics_tbl=<span class="ot">NULL</span></span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a>time=<span class="st">&quot;2019-01-01 2019-07-01&quot;</span></span></code></pre></div>
</div>
<div id="dataframe-1" class="section level3">
<h3>3.2.3 Dataframe</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb13-2"><a href="#cb13-2"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb13-3"><a href="#cb13-3"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb13-5"><a href="#cb13-5"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>        </span>
<span id="cb13-7"><a href="#cb13-7"></a>       x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>related_queries)</span>
<span id="cb13-8"><a href="#cb13-8"></a>        </span>
<span id="cb13-9"><a href="#cb13-9"></a>        <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb13-10"><a href="#cb13-10"></a>                n_term=<span class="dv">10</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>                top_n_related_topics_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="st">                        </span><span class="kw">pluck</span>(<span class="st">&quot;related_queries&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="st">                        </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="st">                        </span><span class="kw">filter</span>(related_queries <span class="op">==</span><span class="st"> &quot;top&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(subject)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="st">                        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="st">                        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="st">                        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="st">                        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>n_term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="st">                        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb13-22"><a href="#cb13-22"></a>                </span>
<span id="cb13-23"><a href="#cb13-23"></a>                topics_tbl=<span class="st"> </span><span class="kw">union_all</span>(topics_tbl,top_n_related_topics_tbl)</span>
<span id="cb13-24"><a href="#cb13-24"></a>        }</span>
<span id="cb13-25"><a href="#cb13-25"></a>}</span></code></pre></div>
</div>
<div id="data-manipulation-1" class="section level3">
<h3>3.2.4 Data Manipulation</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>queries_tbl=topics_tbl<span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>),</span>
<span id="cb14-4"><a href="#cb14-4"></a>               <span class="dt">value =</span> <span class="kw">stri_trans_general</span>(value, <span class="st">&#39;es&#39;</span>))<span class="op">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,value) <span class="op">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_in=</span><span class="kw">max</span>(interest))<span class="op">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(max_in)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="st">        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="st">        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="st">                       </span><span class="kw">fct_reorder</span>(interest))</span></code></pre></div>
</div>
<div id="save-bbdd-1" class="section level3">
<h3>3.2.5 Save BBDD</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># 1.2.1   Save BBDD  --------------------------------------------------------</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">saveRDS</span>(queries_tbl,<span class="st">&quot;queries_tbl19.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="read-bbdd-1" class="section level3">
<h3>3.1.6 Read BBDD</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>queries_tbl =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;queries_tbl19.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="plot-1" class="section level3">
<h3>3.1.7 Plot</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>queries=queries_tbl <span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, interest, <span class="dt">color =</span> keyword)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> value, <span class="dt">yend =</span> <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="st">        </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="st">        </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="st">        </span><span class="kw">theme_tq</span>()<span class="op">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="st">        </span><span class="kw">scale_color_tq</span>()<span class="op">+</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;2019&quot;</span>)<span class="op">+</span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="kw">plot</span>(queries)</span></code></pre></div>
</div>
<div id="clear-objects-from-de-workspace-1" class="section level3">
<h3>3.1.8 Clear Objects from de workspace</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span></code></pre></div>
</div>
</div>
<div id="interest-over-time-2019" class="section level2">
<h2>3.3 Interest Over Time 2019</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># 1.3  Interest Over Time 2019 -----------------------------------------------</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb19-4"><a href="#cb19-4"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a>time=<span class="st">&quot;2019-01-01 2019-07-01&quot;</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>interest_tbl=<span class="ot">NULL</span></span>
<span id="cb19-8"><a href="#cb19-8"></a></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb19-10"><a href="#cb19-10"></a>        </span>
<span id="cb19-11"><a href="#cb19-11"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb19-12"><a href="#cb19-12"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb19-14"><a href="#cb19-14"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-15"><a href="#cb19-15"></a>        </span>
<span id="cb19-16"><a href="#cb19-16"></a>        interest_time_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="st">                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>)</span>
<span id="cb19-18"><a href="#cb19-18"></a>        </span>
<span id="cb19-19"><a href="#cb19-19"></a>        interest_tbl=<span class="st"> </span><span class="kw">union_all</span>(interest_tbl,interest_time_tbl)</span>
<span id="cb19-20"><a href="#cb19-20"></a>}</span>
<span id="cb19-21"><a href="#cb19-21"></a></span>
<span id="cb19-22"><a href="#cb19-22"></a>interest_tbl_edit=interest_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-23"><a href="#cb19-23"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-24"><a href="#cb19-24"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-25"><a href="#cb19-25"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb19-26"><a href="#cb19-26"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,date) <span class="op">%&gt;%</span></span>
<span id="cb19-27"><a href="#cb19-27"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">sum_hits=</span><span class="kw">sum</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-28"><a href="#cb19-28"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(sum_hits)) <span class="op">%&gt;%</span></span>
<span id="cb19-29"><a href="#cb19-29"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span></span>
<span id="cb19-30"><a href="#cb19-30"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_hits=</span><span class="kw">max</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-31"><a href="#cb19-31"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">min_hits=</span><span class="dv">0</span>)<span class="op">%&gt;%</span></span>
<span id="cb19-32"><a href="#cb19-32"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">rescal=</span><span class="kw">trunc</span>((hits<span class="op">-</span>min_hits)<span class="op">/</span>(max_hits<span class="op">-</span>min_hits)<span class="op">*</span><span class="dv">100</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-33"><a href="#cb19-33"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(rescal))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-34"><a href="#cb19-34"></a><span class="st">        </span><span class="kw">select</span>(date,hits,keyword,geo,time,gprop,category)</span>
<span id="cb19-35"><a href="#cb19-35"></a><span class="co"># 1.3.1   Save BBDD  --------------------------------------------------------</span></span>
<span id="cb19-36"><a href="#cb19-36"></a><span class="kw">saveRDS</span>(interest_tbl,<span class="st">&quot;interest_tbl_org19.rds&quot;</span>)</span>
<span id="cb19-37"><a href="#cb19-37"></a><span class="kw">saveRDS</span>(interest_tbl_edit,<span class="st">&quot;interest_tbl19.rds&quot;</span>)</span>
<span id="cb19-38"><a href="#cb19-38"></a><span class="co"># 1.3.2   Graphic -------------------------------------------------------------</span></span>
<span id="cb19-39"><a href="#cb19-39"></a>interest_tbl=<span class="kw">readRDS</span>(<span class="st">&quot;interest_tbl19.rds&quot;</span>)</span>
<span id="cb19-40"><a href="#cb19-40"></a></span>
<span id="cb19-41"><a href="#cb19-41"></a>Interest=interest_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-42"><a href="#cb19-42"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date,hits, <span class="dt">color=</span>keyword))<span class="op">+</span></span>
<span id="cb19-43"><a href="#cb19-43"></a><span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>keyword), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-44"><a href="#cb19-44"></a><span class="st">        </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb19-45"><a href="#cb19-45"></a><span class="st">        </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-46"><a href="#cb19-46"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Keyword Trends - Over Time - 2019&quot;</span>) <span class="op">+</span></span>
<span id="cb19-47"><a href="#cb19-47"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb19-48"><a href="#cb19-48"></a></span>
<span id="cb19-49"><a href="#cb19-49"></a><span class="kw">plot</span>(Interest)</span>
<span id="cb19-50"><a href="#cb19-50"></a></span>
<span id="cb19-51"><a href="#cb19-51"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-52"><a href="#cb19-52"></a></span>
<span id="cb19-53"><a href="#cb19-53"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-54"><a href="#cb19-54"></a></span>
<span id="cb19-55"><a href="#cb19-55"></a><span class="co"># 1.4  Geography Topics Time 2019 -----------------------------------------------------</span></span>
<span id="cb19-56"><a href="#cb19-56"></a></span>
<span id="cb19-57"><a href="#cb19-57"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-58"><a href="#cb19-58"></a>                   <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb19-59"><a href="#cb19-59"></a>                   <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb19-60"><a href="#cb19-60"></a>country_tbl=<span class="ot">NULL</span></span>
<span id="cb19-61"><a href="#cb19-61"></a>time=<span class="st">&quot;2019-01-01 2019-07-01&quot;</span></span>
<span id="cb19-62"><a href="#cb19-62"></a></span>
<span id="cb19-63"><a href="#cb19-63"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb19-64"><a href="#cb19-64"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb19-65"><a href="#cb19-65"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-66"><a href="#cb19-66"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb19-67"><a href="#cb19-67"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-68"><a href="#cb19-68"></a>        </span>
<span id="cb19-69"><a href="#cb19-69"></a>        country_time_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-70"><a href="#cb19-70"></a><span class="st">                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_by_country&quot;</span>)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-71"><a href="#cb19-71"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">hits=</span><span class="kw">as.numeric</span>(hits))</span>
<span id="cb19-72"><a href="#cb19-72"></a>        </span>
<span id="cb19-73"><a href="#cb19-73"></a>        country_tbl=<span class="st"> </span><span class="kw">union_all</span>(country_tbl,country_time_tbl)</span>
<span id="cb19-74"><a href="#cb19-74"></a>}</span>
<span id="cb19-75"><a href="#cb19-75"></a>country_time_tbl=country_tbl</span>
<span id="cb19-76"><a href="#cb19-76"></a></span>
<span id="cb19-77"><a href="#cb19-77"></a>country_tbl=<span class="kw">readRDS</span>(<span class="st">&quot;country_time_tbl19.rds&quot;</span>)</span>
<span id="cb19-78"><a href="#cb19-78"></a></span>
<span id="cb19-79"><a href="#cb19-79"></a>country_tbl=country_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-80"><a href="#cb19-80"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-81"><a href="#cb19-81"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-82"><a href="#cb19-82"></a>                              <span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-83"><a href="#cb19-83"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb19-84"><a href="#cb19-84"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits=</span><span class="kw">replace_na</span>(hits,<span class="dv">0</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-85"><a href="#cb19-85"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,location) <span class="op">%&gt;%</span></span>
<span id="cb19-86"><a href="#cb19-86"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">sum_hits=</span><span class="kw">sum</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-87"><a href="#cb19-87"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(sum_hits))<span class="op">%&gt;%</span></span>
<span id="cb19-88"><a href="#cb19-88"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>sum_hits)<span class="op">%&gt;%</span></span>
<span id="cb19-89"><a href="#cb19-89"></a><span class="st">        </span><span class="kw">distinct</span>()</span>
<span id="cb19-90"><a href="#cb19-90"></a></span>
<span id="cb19-91"><a href="#cb19-91"></a><span class="co"># 1.4.1   Mapping data  -----------------------------------------</span></span>
<span id="cb19-92"><a href="#cb19-92"></a>mapa=<span class="kw">st_read</span>(<span class="st">&quot;mapa_amc.shp&quot;</span>)</span>
<span id="cb19-93"><a href="#cb19-93"></a></span>
<span id="cb19-94"><a href="#cb19-94"></a>Tema1_mapa=<span class="kw">data.frame</span>(mapa)<span class="op">%&gt;%</span></span>
<span id="cb19-95"><a href="#cb19-95"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">location=</span><span class="kw">as.character</span>(location),</span>
<span id="cb19-96"><a href="#cb19-96"></a>               <span class="dt">keyword=</span><span class="kw">as.character</span>(<span class="st">&quot;Cyberbullying&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-97"><a href="#cb19-97"></a><span class="st">        </span><span class="kw">select</span>(location,keyword)</span>
<span id="cb19-98"><a href="#cb19-98"></a></span>
<span id="cb19-99"><a href="#cb19-99"></a>Tema2_mapa=<span class="kw">data.frame</span>(mapa)<span class="op">%&gt;%</span></span>
<span id="cb19-100"><a href="#cb19-100"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">location=</span><span class="kw">as.character</span>(location),</span>
<span id="cb19-101"><a href="#cb19-101"></a>               <span class="dt">keyword=</span><span class="kw">as.character</span>(<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-102"><a href="#cb19-102"></a><span class="st">        </span><span class="kw">select</span>(location,keyword)</span>
<span id="cb19-103"><a href="#cb19-103"></a></span>
<span id="cb19-104"><a href="#cb19-104"></a>data_mapa=<span class="kw">union_all</span>(Tema1_mapa,Tema2_mapa)</span>
<span id="cb19-105"><a href="#cb19-105"></a><span class="kw">rm</span>(Tema1_mapa,Tema2_mapa)</span>
<span id="cb19-106"><a href="#cb19-106"></a></span>
<span id="cb19-107"><a href="#cb19-107"></a>country_map=<span class="kw">left_join</span>(data_mapa,country_tbl,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;location&quot;</span>,<span class="st">&quot;keyword&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-108"><a href="#cb19-108"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">geo =</span><span class="st">&quot;world&quot;</span>,<span class="dt">gprop=</span><span class="st">&quot;web&quot;</span>)<span class="op">%&gt;%</span></span>
<span id="cb19-109"><a href="#cb19-109"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits=</span><span class="kw">replace_na</span>(hits,<span class="dv">0</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-110"><a href="#cb19-110"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,location) <span class="op">%&gt;%</span></span>
<span id="cb19-111"><a href="#cb19-111"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">sum_hits=</span><span class="kw">sum</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-112"><a href="#cb19-112"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(sum_hits)) <span class="op">%&gt;%</span></span>
<span id="cb19-113"><a href="#cb19-113"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span></span>
<span id="cb19-114"><a href="#cb19-114"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_hits=</span><span class="kw">max</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-115"><a href="#cb19-115"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">min_hits=</span><span class="dv">0</span>)<span class="op">%&gt;%</span></span>
<span id="cb19-116"><a href="#cb19-116"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">rescal=</span><span class="kw">trunc</span>((hits<span class="op">-</span>min_hits)<span class="op">/</span>(max_hits<span class="op">-</span>min_hits)<span class="op">*</span><span class="dv">100</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-117"><a href="#cb19-117"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(rescal))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-118"><a href="#cb19-118"></a><span class="st">        </span><span class="kw">select</span>(location,keyword,hits,geo,gprop)</span>
<span id="cb19-119"><a href="#cb19-119"></a></span>
<span id="cb19-120"><a href="#cb19-120"></a>map_plot=mapa<span class="op">%&gt;%</span></span>
<span id="cb19-121"><a href="#cb19-121"></a><span class="st">        </span><span class="kw">select</span>(location)<span class="op">%&gt;%</span></span>
<span id="cb19-122"><a href="#cb19-122"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">location=</span><span class="kw">as.character</span>(location))<span class="op">%&gt;%</span></span>
<span id="cb19-123"><a href="#cb19-123"></a><span class="st">        </span><span class="kw">left_join</span>(country_map,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;location&quot;</span>))</span>
<span id="cb19-124"><a href="#cb19-124"></a></span>
<span id="cb19-125"><a href="#cb19-125"></a><span class="co"># 1.4.2   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-126"><a href="#cb19-126"></a><span class="kw">saveRDS</span>(country_time_tbl,<span class="st">&quot;country_time_tbl19.rds&quot;</span>)</span>
<span id="cb19-127"><a href="#cb19-127"></a><span class="kw">saveRDS</span>(country_tbl,<span class="st">&quot;country_tbl19.rds&quot;</span>)</span>
<span id="cb19-128"><a href="#cb19-128"></a><span class="kw">saveRDS</span>(country_map,<span class="st">&quot;country_map19.rds&quot;</span>)</span>
<span id="cb19-129"><a href="#cb19-129"></a><span class="kw">write_sf</span>(map_plot,<span class="st">&quot;map_plot19.shp&quot;</span>)</span>
<span id="cb19-130"><a href="#cb19-130"></a></span>
<span id="cb19-131"><a href="#cb19-131"></a><span class="co"># 1.4.3   Graphic - Mapa -------------------------------------------------------------</span></span>
<span id="cb19-132"><a href="#cb19-132"></a>map_plot=<span class="kw">st_read</span>(<span class="st">&quot;map_plot19.shp&quot;</span>)</span>
<span id="cb19-133"><a href="#cb19-133"></a></span>
<span id="cb19-134"><a href="#cb19-134"></a>geo_word=<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb19-135"><a href="#cb19-135"></a><span class="st">        </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> map_plot,<span class="kw">aes</span>(<span class="dt">fill =</span> hits),<span class="dt">color =</span> <span class="st">&quot;whitesmoke&quot;</span>,<span class="dt">size=</span><span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb19-136"><a href="#cb19-136"></a><span class="st">        </span><span class="kw">scale_fill_viridis_c</span>()<span class="op">+</span></span>
<span id="cb19-137"><a href="#cb19-137"></a><span class="st">        </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb19-138"><a href="#cb19-138"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb19-139"><a href="#cb19-139"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Keyword Trends - Word - 2019&quot;</span>)</span>
<span id="cb19-140"><a href="#cb19-140"></a></span>
<span id="cb19-141"><a href="#cb19-141"></a><span class="kw">plot</span>(geo_word)</span>
<span id="cb19-142"><a href="#cb19-142"></a></span>
<span id="cb19-143"><a href="#cb19-143"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-144"><a href="#cb19-144"></a></span>
<span id="cb19-145"><a href="#cb19-145"></a><span class="co"># 2. Data 2020 ------------------------------------------------------------</span></span>
<span id="cb19-146"><a href="#cb19-146"></a><span class="co"># 2.1   Topics Over Time 2020-----------------------------------------------</span></span>
<span id="cb19-147"><a href="#cb19-147"></a></span>
<span id="cb19-148"><a href="#cb19-148"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-149"><a href="#cb19-149"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb19-150"><a href="#cb19-150"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb19-151"><a href="#cb19-151"></a>topics_tbl=<span class="ot">NULL</span></span>
<span id="cb19-152"><a href="#cb19-152"></a></span>
<span id="cb19-153"><a href="#cb19-153"></a>time=<span class="st">&quot;2020-01-01 2020-07-01&quot;</span></span>
<span id="cb19-154"><a href="#cb19-154"></a></span>
<span id="cb19-155"><a href="#cb19-155"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb19-156"><a href="#cb19-156"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb19-157"><a href="#cb19-157"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-158"><a href="#cb19-158"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb19-159"><a href="#cb19-159"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-160"><a href="#cb19-160"></a>        </span>
<span id="cb19-161"><a href="#cb19-161"></a>        n_term=<span class="dv">10</span></span>
<span id="cb19-162"><a href="#cb19-162"></a>        top_n_related_topics_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-163"><a href="#cb19-163"></a><span class="st">                </span><span class="kw">pluck</span>(<span class="st">&quot;related_topics&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-164"><a href="#cb19-164"></a><span class="st">                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-165"><a href="#cb19-165"></a><span class="st">                </span><span class="kw">filter</span>(related_topics <span class="op">==</span><span class="st"> &quot;top&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-166"><a href="#cb19-166"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(subject)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-167"><a href="#cb19-167"></a><span class="st">                </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-168"><a href="#cb19-168"></a><span class="st">                </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-169"><a href="#cb19-169"></a><span class="st">                </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-170"><a href="#cb19-170"></a><span class="st">                </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>n_term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-171"><a href="#cb19-171"></a><span class="st">                </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-172"><a href="#cb19-172"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb19-173"><a href="#cb19-173"></a>        </span>
<span id="cb19-174"><a href="#cb19-174"></a>        topics_tbl=<span class="st"> </span><span class="kw">union_all</span>(topics_tbl,top_n_related_topics_tbl)</span>
<span id="cb19-175"><a href="#cb19-175"></a>}</span>
<span id="cb19-176"><a href="#cb19-176"></a></span>
<span id="cb19-177"><a href="#cb19-177"></a>topics_tbl=topics_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-178"><a href="#cb19-178"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-179"><a href="#cb19-179"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-180"><a href="#cb19-180"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb19-181"><a href="#cb19-181"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,value) <span class="op">%&gt;%</span></span>
<span id="cb19-182"><a href="#cb19-182"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_in=</span><span class="kw">max</span>(interest))<span class="op">%&gt;%</span></span>
<span id="cb19-183"><a href="#cb19-183"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(max_in)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-184"><a href="#cb19-184"></a><span class="st">        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span></span>
<span id="cb19-185"><a href="#cb19-185"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-186"><a href="#cb19-186"></a><span class="st">        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-187"><a href="#cb19-187"></a><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-188"><a href="#cb19-188"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb19-189"><a href="#cb19-189"></a></span>
<span id="cb19-190"><a href="#cb19-190"></a><span class="co"># 2.1.1   Save BBDD  --------------------------------------------------------</span></span>
<span id="cb19-191"><a href="#cb19-191"></a><span class="kw">saveRDS</span>(topics_tbl,<span class="st">&quot;topics_tbl20.rds&quot;</span>)</span>
<span id="cb19-192"><a href="#cb19-192"></a><span class="co"># 2.1.2   Graphic -------------------------------------------------------------</span></span>
<span id="cb19-193"><a href="#cb19-193"></a></span>
<span id="cb19-194"><a href="#cb19-194"></a>topics_tbl =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;topics_tbl20.rds&quot;</span>)</span>
<span id="cb19-195"><a href="#cb19-195"></a></span>
<span id="cb19-196"><a href="#cb19-196"></a></span>
<span id="cb19-197"><a href="#cb19-197"></a>topics=topics_tbl <span class="op">%&gt;%</span></span>
<span id="cb19-198"><a href="#cb19-198"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, interest, <span class="dt">color =</span> keyword)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-199"><a href="#cb19-199"></a><span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> value, <span class="dt">yend =</span> <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb19-200"><a href="#cb19-200"></a><span class="st">        </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb19-201"><a href="#cb19-201"></a><span class="st">        </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb19-202"><a href="#cb19-202"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></span>
<span id="cb19-203"><a href="#cb19-203"></a><span class="st">        </span><span class="kw">theme_tq</span>()<span class="op">+</span></span>
<span id="cb19-204"><a href="#cb19-204"></a><span class="st">        </span><span class="kw">scale_color_tq</span>()<span class="op">+</span></span>
<span id="cb19-205"><a href="#cb19-205"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;2020&quot;</span>)<span class="op">+</span></span>
<span id="cb19-206"><a href="#cb19-206"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb19-207"><a href="#cb19-207"></a></span>
<span id="cb19-208"><a href="#cb19-208"></a><span class="kw">plot</span>(topics)</span>
<span id="cb19-209"><a href="#cb19-209"></a></span>
<span id="cb19-210"><a href="#cb19-210"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-211"><a href="#cb19-211"></a></span>
<span id="cb19-212"><a href="#cb19-212"></a><span class="co"># 2.2   Queries Over Time 2020-----------------------------------------------</span></span>
<span id="cb19-213"><a href="#cb19-213"></a></span>
<span id="cb19-214"><a href="#cb19-214"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-215"><a href="#cb19-215"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb19-216"><a href="#cb19-216"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb19-217"><a href="#cb19-217"></a>topics_tbl=<span class="ot">NULL</span></span>
<span id="cb19-218"><a href="#cb19-218"></a></span>
<span id="cb19-219"><a href="#cb19-219"></a>time=<span class="st">&quot;2020-01-01 2020-07-01&quot;</span></span>
<span id="cb19-220"><a href="#cb19-220"></a></span>
<span id="cb19-221"><a href="#cb19-221"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb19-222"><a href="#cb19-222"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb19-223"><a href="#cb19-223"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-224"><a href="#cb19-224"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb19-225"><a href="#cb19-225"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-226"><a href="#cb19-226"></a>        </span>
<span id="cb19-227"><a href="#cb19-227"></a>        x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>related_queries)</span>
<span id="cb19-228"><a href="#cb19-228"></a>        </span>
<span id="cb19-229"><a href="#cb19-229"></a>        <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb19-230"><a href="#cb19-230"></a>                n_term=<span class="dv">10</span></span>
<span id="cb19-231"><a href="#cb19-231"></a>                top_n_related_topics_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-232"><a href="#cb19-232"></a><span class="st">                        </span><span class="kw">pluck</span>(<span class="st">&quot;related_queries&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-233"><a href="#cb19-233"></a><span class="st">                        </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-234"><a href="#cb19-234"></a><span class="st">                        </span><span class="kw">filter</span>(related_queries <span class="op">==</span><span class="st"> &quot;top&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-235"><a href="#cb19-235"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(subject)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-236"><a href="#cb19-236"></a><span class="st">                        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-237"><a href="#cb19-237"></a><span class="st">                        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-238"><a href="#cb19-238"></a><span class="st">                        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-239"><a href="#cb19-239"></a><span class="st">                        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>n_term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-240"><a href="#cb19-240"></a><span class="st">                        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-241"><a href="#cb19-241"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb19-242"><a href="#cb19-242"></a>                </span>
<span id="cb19-243"><a href="#cb19-243"></a>                topics_tbl=<span class="st"> </span><span class="kw">union_all</span>(topics_tbl,top_n_related_topics_tbl)</span>
<span id="cb19-244"><a href="#cb19-244"></a>        }</span>
<span id="cb19-245"><a href="#cb19-245"></a>}</span>
<span id="cb19-246"><a href="#cb19-246"></a></span>
<span id="cb19-247"><a href="#cb19-247"></a>queries_tbl=topics_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-248"><a href="#cb19-248"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-249"><a href="#cb19-249"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-250"><a href="#cb19-250"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb19-251"><a href="#cb19-251"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,value) <span class="op">%&gt;%</span></span>
<span id="cb19-252"><a href="#cb19-252"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_in=</span><span class="kw">max</span>(interest))<span class="op">%&gt;%</span></span>
<span id="cb19-253"><a href="#cb19-253"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(max_in)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-254"><a href="#cb19-254"></a><span class="st">        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span></span>
<span id="cb19-255"><a href="#cb19-255"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-256"><a href="#cb19-256"></a><span class="st">        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-257"><a href="#cb19-257"></a><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-258"><a href="#cb19-258"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb19-259"><a href="#cb19-259"></a></span>
<span id="cb19-260"><a href="#cb19-260"></a><span class="co"># 2.2.1   Save BBDD  --------------------------------------------------------</span></span>
<span id="cb19-261"><a href="#cb19-261"></a><span class="kw">saveRDS</span>(queries_tbl,<span class="st">&quot;queries_tbl20.rds&quot;</span>)</span>
<span id="cb19-262"><a href="#cb19-262"></a><span class="co"># 2.2.2   Graphic -------------------------------------------------------------</span></span>
<span id="cb19-263"><a href="#cb19-263"></a></span>
<span id="cb19-264"><a href="#cb19-264"></a>topics_tbl =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;queries_tbl20.rds&quot;</span>)</span>
<span id="cb19-265"><a href="#cb19-265"></a>topics=topics_tbl <span class="op">%&gt;%</span></span>
<span id="cb19-266"><a href="#cb19-266"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, interest, <span class="dt">color =</span> keyword)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-267"><a href="#cb19-267"></a><span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> value, <span class="dt">yend =</span> <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb19-268"><a href="#cb19-268"></a><span class="st">        </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb19-269"><a href="#cb19-269"></a><span class="st">        </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb19-270"><a href="#cb19-270"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></span>
<span id="cb19-271"><a href="#cb19-271"></a><span class="st">        </span><span class="kw">theme_tq</span>()<span class="op">+</span></span>
<span id="cb19-272"><a href="#cb19-272"></a><span class="st">        </span><span class="kw">scale_color_tq</span>()</span>
<span id="cb19-273"><a href="#cb19-273"></a></span>
<span id="cb19-274"><a href="#cb19-274"></a><span class="kw">plot</span>(topics)</span>
<span id="cb19-275"><a href="#cb19-275"></a></span>
<span id="cb19-276"><a href="#cb19-276"></a></span>
<span id="cb19-277"><a href="#cb19-277"></a></span>
<span id="cb19-278"><a href="#cb19-278"></a></span>
<span id="cb19-279"><a href="#cb19-279"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-280"><a href="#cb19-280"></a></span>
<span id="cb19-281"><a href="#cb19-281"></a><span class="co"># 2.3  Interest Over Time 2020 -----------------------------------------------</span></span>
<span id="cb19-282"><a href="#cb19-282"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-283"><a href="#cb19-283"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb19-284"><a href="#cb19-284"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb19-285"><a href="#cb19-285"></a></span>
<span id="cb19-286"><a href="#cb19-286"></a>time=<span class="st">&quot;2020-01-01 2020-07-01&quot;</span></span>
<span id="cb19-287"><a href="#cb19-287"></a>interest_tbl=<span class="ot">NULL</span></span>
<span id="cb19-288"><a href="#cb19-288"></a></span>
<span id="cb19-289"><a href="#cb19-289"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb19-290"><a href="#cb19-290"></a>        </span>
<span id="cb19-291"><a href="#cb19-291"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb19-292"><a href="#cb19-292"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-293"><a href="#cb19-293"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb19-294"><a href="#cb19-294"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-295"><a href="#cb19-295"></a>        </span>
<span id="cb19-296"><a href="#cb19-296"></a>        interest_time_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-297"><a href="#cb19-297"></a><span class="st">                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>)</span>
<span id="cb19-298"><a href="#cb19-298"></a>        </span>
<span id="cb19-299"><a href="#cb19-299"></a>        interest_tbl=<span class="st"> </span><span class="kw">union_all</span>(interest_tbl,interest_time_tbl)</span>
<span id="cb19-300"><a href="#cb19-300"></a>}</span>
<span id="cb19-301"><a href="#cb19-301"></a></span>
<span id="cb19-302"><a href="#cb19-302"></a>interest_tbl_edit=interest_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-303"><a href="#cb19-303"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-304"><a href="#cb19-304"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-305"><a href="#cb19-305"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb19-306"><a href="#cb19-306"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,date) <span class="op">%&gt;%</span></span>
<span id="cb19-307"><a href="#cb19-307"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">sum_hits=</span><span class="kw">sum</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-308"><a href="#cb19-308"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(sum_hits)) <span class="op">%&gt;%</span></span>
<span id="cb19-309"><a href="#cb19-309"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span></span>
<span id="cb19-310"><a href="#cb19-310"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_hits=</span><span class="kw">max</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-311"><a href="#cb19-311"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">min_hits=</span><span class="dv">0</span>)<span class="op">%&gt;%</span></span>
<span id="cb19-312"><a href="#cb19-312"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">rescal=</span><span class="kw">trunc</span>((hits<span class="op">-</span>min_hits)<span class="op">/</span>(max_hits<span class="op">-</span>min_hits)<span class="op">*</span><span class="dv">100</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-313"><a href="#cb19-313"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(rescal))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-314"><a href="#cb19-314"></a><span class="st">        </span><span class="kw">select</span>(date,hits,keyword,geo,time,gprop,category)</span>
<span id="cb19-315"><a href="#cb19-315"></a><span class="co"># 2.3.1   Save BBDD  --------------------------------------------------------</span></span>
<span id="cb19-316"><a href="#cb19-316"></a><span class="kw">saveRDS</span>(interest_tbl,<span class="st">&quot;interest_tbl_org20.rds&quot;</span>)</span>
<span id="cb19-317"><a href="#cb19-317"></a><span class="kw">saveRDS</span>(interest_tbl_edit,<span class="st">&quot;interest_tbl20.rds&quot;</span>)</span>
<span id="cb19-318"><a href="#cb19-318"></a></span>
<span id="cb19-319"><a href="#cb19-319"></a><span class="co"># 2.3.2   Graphic -------------------------------------------------------------</span></span>
<span id="cb19-320"><a href="#cb19-320"></a>interest_tbl=<span class="kw">readRDS</span>(<span class="st">&quot;interest_tbl20.rds&quot;</span>)</span>
<span id="cb19-321"><a href="#cb19-321"></a></span>
<span id="cb19-322"><a href="#cb19-322"></a>Interest=interest_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-323"><a href="#cb19-323"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date,hits, <span class="dt">color=</span>keyword))<span class="op">+</span></span>
<span id="cb19-324"><a href="#cb19-324"></a><span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>keyword), <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-325"><a href="#cb19-325"></a><span class="st">        </span><span class="kw">geom_smooth</span>() <span class="op">+</span></span>
<span id="cb19-326"><a href="#cb19-326"></a><span class="st">        </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb19-327"><a href="#cb19-327"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Keyword Trends - Over Time - 2020&quot;</span>) <span class="op">+</span></span>
<span id="cb19-328"><a href="#cb19-328"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb19-329"><a href="#cb19-329"></a></span>
<span id="cb19-330"><a href="#cb19-330"></a><span class="kw">plot</span>(Interest)</span>
<span id="cb19-331"><a href="#cb19-331"></a></span>
<span id="cb19-332"><a href="#cb19-332"></a></span>
<span id="cb19-333"><a href="#cb19-333"></a></span>
<span id="cb19-334"><a href="#cb19-334"></a></span>
<span id="cb19-335"><a href="#cb19-335"></a></span>
<span id="cb19-336"><a href="#cb19-336"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-337"><a href="#cb19-337"></a></span>
<span id="cb19-338"><a href="#cb19-338"></a><span class="co"># 2.4  Geography Topics Time 2020 -----------------------------------------------------</span></span>
<span id="cb19-339"><a href="#cb19-339"></a></span>
<span id="cb19-340"><a href="#cb19-340"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-341"><a href="#cb19-341"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb19-342"><a href="#cb19-342"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb19-343"><a href="#cb19-343"></a>country_tbl=<span class="ot">NULL</span></span>
<span id="cb19-344"><a href="#cb19-344"></a>time=<span class="st">&quot;2020-01-01 2020-07-01&quot;</span></span>
<span id="cb19-345"><a href="#cb19-345"></a></span>
<span id="cb19-346"><a href="#cb19-346"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb19-347"><a href="#cb19-347"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb19-348"><a href="#cb19-348"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-349"><a href="#cb19-349"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb19-350"><a href="#cb19-350"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-351"><a href="#cb19-351"></a>        </span>
<span id="cb19-352"><a href="#cb19-352"></a>        country_time_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-353"><a href="#cb19-353"></a><span class="st">                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_by_country&quot;</span>)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-354"><a href="#cb19-354"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">hits=</span><span class="kw">as.numeric</span>(hits))</span>
<span id="cb19-355"><a href="#cb19-355"></a>        </span>
<span id="cb19-356"><a href="#cb19-356"></a>        country_tbl=<span class="st"> </span><span class="kw">union_all</span>(country_tbl,country_time_tbl)</span>
<span id="cb19-357"><a href="#cb19-357"></a>}</span>
<span id="cb19-358"><a href="#cb19-358"></a>country_time_tbl=country_tbl</span>
<span id="cb19-359"><a href="#cb19-359"></a></span>
<span id="cb19-360"><a href="#cb19-360"></a>country_tbl=<span class="kw">readRDS</span>(<span class="st">&quot;country_time_tbl20.rds&quot;</span>)</span>
<span id="cb19-361"><a href="#cb19-361"></a></span>
<span id="cb19-362"><a href="#cb19-362"></a>country_tbl=country_tbl<span class="op">%&gt;%</span></span>
<span id="cb19-363"><a href="#cb19-363"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-364"><a href="#cb19-364"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-365"><a href="#cb19-365"></a>                              <span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-366"><a href="#cb19-366"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb19-367"><a href="#cb19-367"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits=</span><span class="kw">replace_na</span>(hits,<span class="dv">0</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-368"><a href="#cb19-368"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,location) <span class="op">%&gt;%</span></span>
<span id="cb19-369"><a href="#cb19-369"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">sum_hits=</span><span class="kw">sum</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-370"><a href="#cb19-370"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(sum_hits))<span class="op">%&gt;%</span></span>
<span id="cb19-371"><a href="#cb19-371"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>sum_hits)<span class="op">%&gt;%</span></span>
<span id="cb19-372"><a href="#cb19-372"></a><span class="st">        </span><span class="kw">distinct</span>()</span>
<span id="cb19-373"><a href="#cb19-373"></a></span>
<span id="cb19-374"><a href="#cb19-374"></a><span class="co"># 2.4.1   Mapping data  -----------------------------------------</span></span>
<span id="cb19-375"><a href="#cb19-375"></a>mapa=<span class="kw">st_read</span>(<span class="st">&quot;mapa_amc.shp&quot;</span>)</span>
<span id="cb19-376"><a href="#cb19-376"></a></span>
<span id="cb19-377"><a href="#cb19-377"></a>Tema1_mapa=<span class="kw">data.frame</span>(mapa)<span class="op">%&gt;%</span></span>
<span id="cb19-378"><a href="#cb19-378"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">location=</span><span class="kw">as.character</span>(location),</span>
<span id="cb19-379"><a href="#cb19-379"></a>               <span class="dt">keyword=</span><span class="kw">as.character</span>(<span class="st">&quot;Cyberbullying&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-380"><a href="#cb19-380"></a><span class="st">        </span><span class="kw">select</span>(location,keyword)</span>
<span id="cb19-381"><a href="#cb19-381"></a></span>
<span id="cb19-382"><a href="#cb19-382"></a>Tema2_mapa=<span class="kw">data.frame</span>(mapa)<span class="op">%&gt;%</span></span>
<span id="cb19-383"><a href="#cb19-383"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">location=</span><span class="kw">as.character</span>(location),</span>
<span id="cb19-384"><a href="#cb19-384"></a>               <span class="dt">keyword=</span><span class="kw">as.character</span>(<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-385"><a href="#cb19-385"></a><span class="st">        </span><span class="kw">select</span>(location,keyword)</span>
<span id="cb19-386"><a href="#cb19-386"></a></span>
<span id="cb19-387"><a href="#cb19-387"></a>data_mapa=<span class="kw">union_all</span>(Tema1_mapa,Tema2_mapa)</span>
<span id="cb19-388"><a href="#cb19-388"></a><span class="kw">rm</span>(Tema1_mapa,Tema2_mapa)</span>
<span id="cb19-389"><a href="#cb19-389"></a></span>
<span id="cb19-390"><a href="#cb19-390"></a>country_map=<span class="kw">left_join</span>(data_mapa,country_tbl,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;location&quot;</span>,<span class="st">&quot;keyword&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-391"><a href="#cb19-391"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">geo =</span><span class="st">&quot;world&quot;</span>,<span class="dt">gprop=</span><span class="st">&quot;web&quot;</span>)<span class="op">%&gt;%</span></span>
<span id="cb19-392"><a href="#cb19-392"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits=</span><span class="kw">replace_na</span>(hits,<span class="dv">0</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-393"><a href="#cb19-393"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,location) <span class="op">%&gt;%</span></span>
<span id="cb19-394"><a href="#cb19-394"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">sum_hits=</span><span class="kw">sum</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-395"><a href="#cb19-395"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(sum_hits)) <span class="op">%&gt;%</span></span>
<span id="cb19-396"><a href="#cb19-396"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span></span>
<span id="cb19-397"><a href="#cb19-397"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_hits=</span><span class="kw">max</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-398"><a href="#cb19-398"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">min_hits=</span><span class="dv">0</span>)<span class="op">%&gt;%</span></span>
<span id="cb19-399"><a href="#cb19-399"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">rescal=</span><span class="kw">trunc</span>((hits<span class="op">-</span>min_hits)<span class="op">/</span>(max_hits<span class="op">-</span>min_hits)<span class="op">*</span><span class="dv">100</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-400"><a href="#cb19-400"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(rescal))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-401"><a href="#cb19-401"></a><span class="st">        </span><span class="kw">select</span>(location,keyword,hits,geo,gprop)</span>
<span id="cb19-402"><a href="#cb19-402"></a></span>
<span id="cb19-403"><a href="#cb19-403"></a>map_plot=mapa<span class="op">%&gt;%</span></span>
<span id="cb19-404"><a href="#cb19-404"></a><span class="st">        </span><span class="kw">select</span>(location)<span class="op">%&gt;%</span></span>
<span id="cb19-405"><a href="#cb19-405"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">location=</span><span class="kw">as.character</span>(location))<span class="op">%&gt;%</span></span>
<span id="cb19-406"><a href="#cb19-406"></a><span class="st">        </span><span class="kw">left_join</span>(country_map,<span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;location&quot;</span>))</span>
<span id="cb19-407"><a href="#cb19-407"></a></span>
<span id="cb19-408"><a href="#cb19-408"></a><span class="co"># 2.4.2   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-409"><a href="#cb19-409"></a><span class="kw">saveRDS</span>(country_time_tbl,<span class="st">&quot;country_time_tbl20.rds&quot;</span>)</span>
<span id="cb19-410"><a href="#cb19-410"></a><span class="kw">saveRDS</span>(country_tbl,<span class="st">&quot;country_tbl20.rds&quot;</span>)</span>
<span id="cb19-411"><a href="#cb19-411"></a><span class="kw">saveRDS</span>(country_map,<span class="st">&quot;country_map20.rds&quot;</span>)</span>
<span id="cb19-412"><a href="#cb19-412"></a><span class="kw">write_sf</span>(map_plot,<span class="st">&quot;map_plot20.shp&quot;</span>)</span>
<span id="cb19-413"><a href="#cb19-413"></a></span>
<span id="cb19-414"><a href="#cb19-414"></a><span class="co"># 2.4.3   Graphic - Mapa -------------------------------------------------------------</span></span>
<span id="cb19-415"><a href="#cb19-415"></a>map_plot=<span class="kw">st_read</span>(<span class="st">&quot;map_plot20.shp&quot;</span>)</span>
<span id="cb19-416"><a href="#cb19-416"></a></span>
<span id="cb19-417"><a href="#cb19-417"></a>geo_word=<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb19-418"><a href="#cb19-418"></a><span class="st">        </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> map_plot,<span class="kw">aes</span>(<span class="dt">fill =</span> hits),<span class="dt">color =</span> <span class="st">&quot;whitesmoke&quot;</span>,<span class="dt">size=</span><span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb19-419"><a href="#cb19-419"></a><span class="st">        </span><span class="kw">scale_fill_viridis_c</span>()<span class="op">+</span></span>
<span id="cb19-420"><a href="#cb19-420"></a><span class="st">        </span><span class="kw">theme_minimal</span>()<span class="op">+</span></span>
<span id="cb19-421"><a href="#cb19-421"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb19-422"><a href="#cb19-422"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Keyword Trends - Word - 2020&quot;</span>)</span>
<span id="cb19-423"><a href="#cb19-423"></a></span>
<span id="cb19-424"><a href="#cb19-424"></a><span class="kw">plot</span>(geo_word)</span>
<span id="cb19-425"><a href="#cb19-425"></a></span>
<span id="cb19-426"><a href="#cb19-426"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb19-427"><a href="#cb19-427"></a></span>
<span id="cb19-428"><a href="#cb19-428"></a><span class="co"># 3   Interest Over Time GPROP ---------------------------------------------------------------</span></span>
<span id="cb19-429"><a href="#cb19-429"></a>mapa=<span class="kw">st_read</span>(<span class="st">&quot;mapa_amc.shp&quot;</span>)</span>
<span id="cb19-430"><a href="#cb19-430"></a>mapa=<span class="kw">data.frame</span>(mapa)<span class="op">%&gt;%</span></span>
<span id="cb19-431"><a href="#cb19-431"></a><span class="st">        </span><span class="kw">select</span>(CNTR_ID,location)<span class="op">%&gt;%</span></span>
<span id="cb19-432"><a href="#cb19-432"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">geo=</span><span class="kw">as.character</span>(CNTR_ID),</span>
<span id="cb19-433"><a href="#cb19-433"></a>               <span class="dt">location=</span><span class="kw">as.character</span>(location))<span class="op">%&gt;%</span></span>
<span id="cb19-434"><a href="#cb19-434"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>CNTR_ID)</span>
<span id="cb19-435"><a href="#cb19-435"></a></span>
<span id="cb19-436"><a href="#cb19-436"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb19-437"><a href="#cb19-437"></a>           <span class="st">&quot;Sexting&quot;</span>,<span class="st">&quot;Child grooming&quot;</span>,<span class="st">&quot;School bullying&quot;</span>,</span>
<span id="cb19-438"><a href="#cb19-438"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb19-439"><a href="#cb19-439"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb19-440"><a href="#cb19-440"></a>country_term=<span class="ot">NULL</span></span>
<span id="cb19-441"><a href="#cb19-441"></a></span>
<span id="cb19-442"><a href="#cb19-442"></a><span class="cf">for</span> (t <span class="cf">in</span> terminos) {</span>
<span id="cb19-443"><a href="#cb19-443"></a>        dato=mapa</span>
<span id="cb19-444"><a href="#cb19-444"></a>        dato<span class="op">$</span>keywords=t</span>
<span id="cb19-445"><a href="#cb19-445"></a>        country_term=<span class="kw">union_all</span>(country_term,dato)</span>
<span id="cb19-446"><a href="#cb19-446"></a>}</span>
<span id="cb19-447"><a href="#cb19-447"></a></span>
<span id="cb19-448"><a href="#cb19-448"></a>x=<span class="st">&quot;2019-07-01&quot;</span></span>
<span id="cb19-449"><a href="#cb19-449"></a></span>
<span id="cb19-450"><a href="#cb19-450"></a>gtrend_gral=<span class="kw">data_frame</span>()</span>
<span id="cb19-451"><a href="#cb19-451"></a>gtrend_gral<span class="op">$</span>date=<span class="kw">as.POSIXct</span>(x)</span>
<span id="cb19-452"><a href="#cb19-452"></a>gtrend_gral<span class="op">$</span>hits=<span class="kw">as.integer</span>()</span>
<span id="cb19-453"><a href="#cb19-453"></a>gtrend_gral<span class="op">$</span>keyword=<span class="kw">as.character</span>()</span>
<span id="cb19-454"><a href="#cb19-454"></a>gtrend_gral<span class="op">$</span>geo=<span class="kw">as.character</span>()</span>
<span id="cb19-455"><a href="#cb19-455"></a>gtrend_gral<span class="op">$</span>gprop=<span class="kw">as.character</span>()</span>
<span id="cb19-456"><a href="#cb19-456"></a></span>
<span id="cb19-457"><a href="#cb19-457"></a>gtrend_new=gtrend_gral</span>
<span id="cb19-458"><a href="#cb19-458"></a>gtrend_ytb=gtrend_gral</span>
<span id="cb19-459"><a href="#cb19-459"></a><span class="kw">rm</span>(x,mapa,dato,t)</span>
<span id="cb19-460"><a href="#cb19-460"></a></span>
<span id="cb19-461"><a href="#cb19-461"></a><span class="co"># 3.1 Web gprop 2019----------------------------------------------------------</span></span>
<span id="cb19-462"><a href="#cb19-462"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(country_term)[<span class="dv">1</span>]) {</span>
<span id="cb19-463"><a href="#cb19-463"></a>        country=country_term[i,<span class="dv">2</span>]</span>
<span id="cb19-464"><a href="#cb19-464"></a>        search_terms=country_term[i,<span class="dv">3</span>]</span>
<span id="cb19-465"><a href="#cb19-465"></a>        </span>
<span id="cb19-466"><a href="#cb19-466"></a>        <span class="cf">for</span> (p <span class="cf">in</span> country) {</span>
<span id="cb19-467"><a href="#cb19-467"></a>                gtrends_lst =<span class="st"> </span>search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-468"><a href="#cb19-468"></a><span class="st">                        </span><span class="kw">gtrends</span>(<span class="dt">geo =</span>p,</span>
<span id="cb19-469"><a href="#cb19-469"></a>                                <span class="dt">time =</span> <span class="st">&quot;2019-01-01 2019-07-01&quot;</span>,</span>
<span id="cb19-470"><a href="#cb19-470"></a>                                <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-471"><a href="#cb19-471"></a>                </span>
<span id="cb19-472"><a href="#cb19-472"></a>                x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>interest_over_time)</span>
<span id="cb19-473"><a href="#cb19-473"></a>                </span>
<span id="cb19-474"><a href="#cb19-474"></a>                <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb19-475"><a href="#cb19-475"></a>                        </span>
<span id="cb19-476"><a href="#cb19-476"></a>                        info=<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span></span>
<span id="cb19-477"><a href="#cb19-477"></a><span class="st">                                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-478"><a href="#cb19-478"></a><span class="st">                                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb19-479"><a href="#cb19-479"></a><span class="st">                                </span><span class="kw">select</span>(date,hits,keyword,geo,gprop)</span>
<span id="cb19-480"><a href="#cb19-480"></a>                        </span>
<span id="cb19-481"><a href="#cb19-481"></a>                        info<span class="op">$</span>hits=<span class="kw">as.integer</span>(info<span class="op">$</span>hits)</span>
<span id="cb19-482"><a href="#cb19-482"></a>                        </span>
<span id="cb19-483"><a href="#cb19-483"></a>                        gtrend_gral=<span class="kw">union</span>(gtrend_gral,info)}</span>
<span id="cb19-484"><a href="#cb19-484"></a>        }</span>
<span id="cb19-485"><a href="#cb19-485"></a>}</span>
<span id="cb19-486"><a href="#cb19-486"></a>gtrend_gral19=gtrend_gral</span>
<span id="cb19-487"><a href="#cb19-487"></a></span>
<span id="cb19-488"><a href="#cb19-488"></a><span class="co"># 3.1.1   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-489"><a href="#cb19-489"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/GTrends_web_news_ytb/data_trends&quot;</span>)</span>
<span id="cb19-490"><a href="#cb19-490"></a><span class="kw">saveRDS</span>(gtrend_gral19,<span class="st">&quot;gtrends_gral19.rds&quot;</span>)</span>
<span id="cb19-491"><a href="#cb19-491"></a></span>
<span id="cb19-492"><a href="#cb19-492"></a><span class="co"># 3.2 Web gprop 2020----------------------------------------------------------</span></span>
<span id="cb19-493"><a href="#cb19-493"></a>gtrend_gral=gtrend_new</span>
<span id="cb19-494"><a href="#cb19-494"></a></span>
<span id="cb19-495"><a href="#cb19-495"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(country_term)[<span class="dv">1</span>]) {</span>
<span id="cb19-496"><a href="#cb19-496"></a>        country=country_term[i,<span class="dv">2</span>]</span>
<span id="cb19-497"><a href="#cb19-497"></a>        search_terms=country_term[i,<span class="dv">3</span>]</span>
<span id="cb19-498"><a href="#cb19-498"></a>        </span>
<span id="cb19-499"><a href="#cb19-499"></a>        <span class="cf">for</span> (p <span class="cf">in</span> country) {</span>
<span id="cb19-500"><a href="#cb19-500"></a>                gtrends_lst =<span class="st"> </span>search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-501"><a href="#cb19-501"></a><span class="st">                        </span><span class="kw">gtrends</span>(<span class="dt">geo =</span>p,</span>
<span id="cb19-502"><a href="#cb19-502"></a>                                <span class="dt">time =</span> <span class="st">&quot;2020-01-01 2020-07-01&quot;</span>,</span>
<span id="cb19-503"><a href="#cb19-503"></a>                                <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-504"><a href="#cb19-504"></a>                </span>
<span id="cb19-505"><a href="#cb19-505"></a>                x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>interest_over_time)</span>
<span id="cb19-506"><a href="#cb19-506"></a>                </span>
<span id="cb19-507"><a href="#cb19-507"></a>                <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb19-508"><a href="#cb19-508"></a>                        </span>
<span id="cb19-509"><a href="#cb19-509"></a>                        info=<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span></span>
<span id="cb19-510"><a href="#cb19-510"></a><span class="st">                                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-511"><a href="#cb19-511"></a><span class="st">                                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></span>
<span id="cb19-512"><a href="#cb19-512"></a><span class="st">                                </span><span class="kw">select</span>(date,hits,keyword,geo,gprop)</span>
<span id="cb19-513"><a href="#cb19-513"></a>                        </span>
<span id="cb19-514"><a href="#cb19-514"></a>                        info<span class="op">$</span>hits=<span class="kw">as.integer</span>(info<span class="op">$</span>hits)</span>
<span id="cb19-515"><a href="#cb19-515"></a>                        </span>
<span id="cb19-516"><a href="#cb19-516"></a>                        gtrend_gral=<span class="kw">union</span>(gtrend_gral,info)}</span>
<span id="cb19-517"><a href="#cb19-517"></a>        }</span>
<span id="cb19-518"><a href="#cb19-518"></a>}</span>
<span id="cb19-519"><a href="#cb19-519"></a>gtrend_gral20=gtrend_gral</span>
<span id="cb19-520"><a href="#cb19-520"></a></span>
<span id="cb19-521"><a href="#cb19-521"></a><span class="co"># 3.2.1   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-522"><a href="#cb19-522"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/GTrends_web_news_ytb/data_trends&quot;</span>)</span>
<span id="cb19-523"><a href="#cb19-523"></a><span class="kw">saveRDS</span>(gtrend_gral20,<span class="st">&quot;gtrends_gral20.rds&quot;</span>)</span>
<span id="cb19-524"><a href="#cb19-524"></a>gtrend_gral=gtrend_new</span>
<span id="cb19-525"><a href="#cb19-525"></a></span>
<span id="cb19-526"><a href="#cb19-526"></a><span class="co"># 3.3 News gprop 2019 --------------------------------------------------------------</span></span>
<span id="cb19-527"><a href="#cb19-527"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(country_term)[<span class="dv">1</span>]) {</span>
<span id="cb19-528"><a href="#cb19-528"></a>        country=country_term[i,<span class="dv">2</span>]</span>
<span id="cb19-529"><a href="#cb19-529"></a>        search_terms=country_term[i,<span class="dv">3</span>]</span>
<span id="cb19-530"><a href="#cb19-530"></a>        <span class="cf">for</span> (p <span class="cf">in</span> country) {</span>
<span id="cb19-531"><a href="#cb19-531"></a>                gtrends_lst =<span class="st"> </span>search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-532"><a href="#cb19-532"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">geo=</span>p,</span>
<span id="cb19-533"><a href="#cb19-533"></a>                        <span class="dt">time =</span> <span class="st">&quot;2019-01-01 2019-07-01&quot;</span>,</span>
<span id="cb19-534"><a href="#cb19-534"></a>                        <span class="dt">gprop =</span> <span class="st">&quot;news&quot;</span>,</span>
<span id="cb19-535"><a href="#cb19-535"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-536"><a href="#cb19-536"></a>                        </span>
<span id="cb19-537"><a href="#cb19-537"></a>                        x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>interest_over_time)</span>
<span id="cb19-538"><a href="#cb19-538"></a>                        </span>
<span id="cb19-539"><a href="#cb19-539"></a>                        <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb19-540"><a href="#cb19-540"></a>                                info=<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span></span>
<span id="cb19-541"><a href="#cb19-541"></a><span class="st">                                        </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-542"><a href="#cb19-542"></a><span class="st">                                        </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-543"><a href="#cb19-543"></a><span class="st">                                        </span><span class="kw">select</span>(date,hits,keyword,geo,gprop)</span>
<span id="cb19-544"><a href="#cb19-544"></a>                                </span>
<span id="cb19-545"><a href="#cb19-545"></a>                                info<span class="op">$</span>hits=<span class="kw">as.integer</span>(info<span class="op">$</span>hits)</span>
<span id="cb19-546"><a href="#cb19-546"></a>                                gtrend_new=<span class="kw">union</span>(gtrend_new,info)}</span>
<span id="cb19-547"><a href="#cb19-547"></a>        }</span>
<span id="cb19-548"><a href="#cb19-548"></a>}</span>
<span id="cb19-549"><a href="#cb19-549"></a>gtrend_new19=gtrend_new</span>
<span id="cb19-550"><a href="#cb19-550"></a></span>
<span id="cb19-551"><a href="#cb19-551"></a><span class="co"># 3.3.1   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-552"><a href="#cb19-552"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/GTrends_web_news_ytb/data_trends&quot;</span>)</span>
<span id="cb19-553"><a href="#cb19-553"></a><span class="kw">saveRDS</span>(gtrend_new19,<span class="st">&quot;gtrend_new19.rds&quot;</span>)</span>
<span id="cb19-554"><a href="#cb19-554"></a></span>
<span id="cb19-555"><a href="#cb19-555"></a><span class="co"># 3.4 News gprop 2020 --------------------------------------------------------------</span></span>
<span id="cb19-556"><a href="#cb19-556"></a>gtrend_new=gtrend_gral</span>
<span id="cb19-557"><a href="#cb19-557"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(country_term)[<span class="dv">1</span>]) {</span>
<span id="cb19-558"><a href="#cb19-558"></a>        country=country_term[i,<span class="dv">2</span>]</span>
<span id="cb19-559"><a href="#cb19-559"></a>        search_terms=country_term[i,<span class="dv">3</span>]</span>
<span id="cb19-560"><a href="#cb19-560"></a>        <span class="cf">for</span> (p <span class="cf">in</span> country) {</span>
<span id="cb19-561"><a href="#cb19-561"></a>                gtrends_lst =<span class="st"> </span>search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-562"><a href="#cb19-562"></a><span class="st">                        </span><span class="kw">gtrends</span>(<span class="dt">geo=</span>p,</span>
<span id="cb19-563"><a href="#cb19-563"></a>                                <span class="dt">time =</span> <span class="st">&quot;2020-01-01 2020-07-01&quot;</span>,</span>
<span id="cb19-564"><a href="#cb19-564"></a>                                <span class="dt">gprop =</span> <span class="st">&quot;news&quot;</span>,</span>
<span id="cb19-565"><a href="#cb19-565"></a>                                <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-566"><a href="#cb19-566"></a>                </span>
<span id="cb19-567"><a href="#cb19-567"></a>                x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>interest_over_time)</span>
<span id="cb19-568"><a href="#cb19-568"></a>                </span>
<span id="cb19-569"><a href="#cb19-569"></a>                <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb19-570"><a href="#cb19-570"></a>                        info=<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span></span>
<span id="cb19-571"><a href="#cb19-571"></a><span class="st">                                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-572"><a href="#cb19-572"></a><span class="st">                                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-573"><a href="#cb19-573"></a><span class="st">                                </span><span class="kw">select</span>(date,hits,keyword,geo,gprop)</span>
<span id="cb19-574"><a href="#cb19-574"></a>                        </span>
<span id="cb19-575"><a href="#cb19-575"></a>                        info<span class="op">$</span>hits=<span class="kw">as.integer</span>(info<span class="op">$</span>hits)</span>
<span id="cb19-576"><a href="#cb19-576"></a>                        gtrend_new=<span class="kw">union</span>(gtrend_new,info)}</span>
<span id="cb19-577"><a href="#cb19-577"></a>        }</span>
<span id="cb19-578"><a href="#cb19-578"></a>}</span>
<span id="cb19-579"><a href="#cb19-579"></a>gtrend_new20=gtrend_new</span>
<span id="cb19-580"><a href="#cb19-580"></a></span>
<span id="cb19-581"><a href="#cb19-581"></a><span class="co"># 3.4.1   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-582"><a href="#cb19-582"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/GTrends_web_news_ytb/data_trends&quot;</span>)</span>
<span id="cb19-583"><a href="#cb19-583"></a><span class="kw">saveRDS</span>(gtrend_new20,<span class="st">&quot;gtrend_new20.rds&quot;</span>)</span>
<span id="cb19-584"><a href="#cb19-584"></a></span>
<span id="cb19-585"><a href="#cb19-585"></a><span class="co"># 3.5 Youtube gprop 2019 --------------------------------------------------------------</span></span>
<span id="cb19-586"><a href="#cb19-586"></a>gtrend_new=gtrend_gral</span>
<span id="cb19-587"><a href="#cb19-587"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(country_term)[<span class="dv">1</span>]) {</span>
<span id="cb19-588"><a href="#cb19-588"></a>        country=country_term[i,<span class="dv">2</span>]</span>
<span id="cb19-589"><a href="#cb19-589"></a>        search_terms=country_term[i,<span class="dv">3</span>]</span>
<span id="cb19-590"><a href="#cb19-590"></a>        <span class="cf">for</span> (p <span class="cf">in</span> country) {</span>
<span id="cb19-591"><a href="#cb19-591"></a>                gtrends_lst =<span class="st"> </span>search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-592"><a href="#cb19-592"></a><span class="st">                        </span><span class="kw">gtrends</span>(<span class="dt">geo=</span>p,</span>
<span id="cb19-593"><a href="#cb19-593"></a>                                <span class="dt">time =</span> <span class="st">&quot;2019-01-01 2019-07-01&quot;</span>,</span>
<span id="cb19-594"><a href="#cb19-594"></a>                                <span class="dt">gprop =</span> <span class="st">&quot;youtube&quot;</span>,</span>
<span id="cb19-595"><a href="#cb19-595"></a>                                <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-596"><a href="#cb19-596"></a>                </span>
<span id="cb19-597"><a href="#cb19-597"></a>                x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>interest_over_time)</span>
<span id="cb19-598"><a href="#cb19-598"></a>                </span>
<span id="cb19-599"><a href="#cb19-599"></a>                <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb19-600"><a href="#cb19-600"></a>                        info=<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span></span>
<span id="cb19-601"><a href="#cb19-601"></a><span class="st">                                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-602"><a href="#cb19-602"></a><span class="st">                                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-603"><a href="#cb19-603"></a><span class="st">                                </span><span class="kw">select</span>(date,hits,keyword,geo,gprop)</span>
<span id="cb19-604"><a href="#cb19-604"></a>                        </span>
<span id="cb19-605"><a href="#cb19-605"></a>                        info<span class="op">$</span>hits=<span class="kw">as.integer</span>(info<span class="op">$</span>hits)</span>
<span id="cb19-606"><a href="#cb19-606"></a>                        gtrend_ytb=<span class="kw">union</span>(gtrend_ytb,info)}</span>
<span id="cb19-607"><a href="#cb19-607"></a>        }</span>
<span id="cb19-608"><a href="#cb19-608"></a>}</span>
<span id="cb19-609"><a href="#cb19-609"></a>gtrend_ytb19=gtrend_ytb</span>
<span id="cb19-610"><a href="#cb19-610"></a><span class="co"># 3.5.1   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-611"><a href="#cb19-611"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/GTrends_web_news_ytb/data_trends&quot;</span>)</span>
<span id="cb19-612"><a href="#cb19-612"></a><span class="kw">saveRDS</span>(gtrend_ytb19,<span class="st">&quot;gtrend_ytb19.rds&quot;</span>)</span>
<span id="cb19-613"><a href="#cb19-613"></a></span>
<span id="cb19-614"><a href="#cb19-614"></a><span class="co"># 3.6 Youtube gprop 2020 --------------------------------------------------------------</span></span>
<span id="cb19-615"><a href="#cb19-615"></a>gtrend_new=gtrend_gral</span>
<span id="cb19-616"><a href="#cb19-616"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(country_term)[<span class="dv">1</span>]) {</span>
<span id="cb19-617"><a href="#cb19-617"></a>        country=country_term[i,<span class="dv">2</span>]</span>
<span id="cb19-618"><a href="#cb19-618"></a>        search_terms=country_term[i,<span class="dv">3</span>]</span>
<span id="cb19-619"><a href="#cb19-619"></a>        <span class="cf">for</span> (p <span class="cf">in</span> country) {</span>
<span id="cb19-620"><a href="#cb19-620"></a>                gtrends_lst =<span class="st"> </span>search_terms <span class="op">%&gt;%</span></span>
<span id="cb19-621"><a href="#cb19-621"></a><span class="st">                        </span><span class="kw">gtrends</span>(<span class="dt">geo=</span>p,</span>
<span id="cb19-622"><a href="#cb19-622"></a>                                <span class="dt">time =</span> <span class="st">&quot;2020-01-01 2020-07-01&quot;</span>,</span>
<span id="cb19-623"><a href="#cb19-623"></a>                                <span class="dt">gprop =</span> <span class="st">&quot;youtube&quot;</span>,</span>
<span id="cb19-624"><a href="#cb19-624"></a>                                <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-625"><a href="#cb19-625"></a>                </span>
<span id="cb19-626"><a href="#cb19-626"></a>                x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>interest_over_time)</span>
<span id="cb19-627"><a href="#cb19-627"></a>                </span>
<span id="cb19-628"><a href="#cb19-628"></a>                <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb19-629"><a href="#cb19-629"></a>                        info=<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span></span>
<span id="cb19-630"><a href="#cb19-630"></a><span class="st">                                </span><span class="kw">pluck</span>(<span class="st">&quot;interest_over_time&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-631"><a href="#cb19-631"></a><span class="st">                                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-632"><a href="#cb19-632"></a><span class="st">                                </span><span class="kw">select</span>(date,hits,keyword,geo,gprop)</span>
<span id="cb19-633"><a href="#cb19-633"></a>                        </span>
<span id="cb19-634"><a href="#cb19-634"></a>                        info<span class="op">$</span>hits=<span class="kw">as.integer</span>(info<span class="op">$</span>hits)</span>
<span id="cb19-635"><a href="#cb19-635"></a>                        gtrend_ytb=<span class="kw">union</span>(gtrend_ytb,info)}</span>
<span id="cb19-636"><a href="#cb19-636"></a>        }</span>
<span id="cb19-637"><a href="#cb19-637"></a>}</span>
<span id="cb19-638"><a href="#cb19-638"></a>gtrend_ytb20=gtrend_ytb</span>
<span id="cb19-639"><a href="#cb19-639"></a><span class="co"># 3.6.1   Save BBDD  ---------------------------------------</span></span>
<span id="cb19-640"><a href="#cb19-640"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/GTrends_web_news_ytb/data_trends&quot;</span>)</span>
<span id="cb19-641"><a href="#cb19-641"></a><span class="kw">saveRDS</span>(gtrend_ytb20,<span class="st">&quot;gtrend_ytb20.rds&quot;</span>)</span>
<span id="cb19-642"><a href="#cb19-642"></a></span>
<span id="cb19-643"><a href="#cb19-643"></a></span>
<span id="cb19-644"><a href="#cb19-644"></a><span class="co"># 4. Trends data_edit ----------------------------------------------------------</span></span>
<span id="cb19-645"><a href="#cb19-645"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/GTrends_web_news_ytb/data_trends&quot;</span>)</span>
<span id="cb19-646"><a href="#cb19-646"></a>archivo=<span class="kw">dir</span>()</span>
<span id="cb19-647"><a href="#cb19-647"></a>data_trends=<span class="ot">NULL</span></span>
<span id="cb19-648"><a href="#cb19-648"></a><span class="cf">for</span> (i <span class="cf">in</span> archivo) {</span>
<span id="cb19-649"><a href="#cb19-649"></a>        data=<span class="kw">readRDS</span>(i)<span class="op">%&gt;%</span></span>
<span id="cb19-650"><a href="#cb19-650"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">mes=</span><span class="kw">as.character.Date</span>(date),</span>
<span id="cb19-651"><a href="#cb19-651"></a>                       <span class="dt">mes=</span><span class="kw">substr</span>(mes,<span class="dv">1</span>,<span class="dv">7</span>),</span>
<span id="cb19-652"><a href="#cb19-652"></a>                       <span class="dt">keyword=</span><span class="kw">str_to_lower</span>(keyword))<span class="op">%&gt;%</span></span>
<span id="cb19-653"><a href="#cb19-653"></a><span class="st">                </span><span class="kw">group_by</span>(mes,geo,keyword)<span class="op">%&gt;%</span></span>
<span id="cb19-654"><a href="#cb19-654"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">hits=</span><span class="kw">sum</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-655"><a href="#cb19-655"></a><span class="st">                </span><span class="kw">select</span>(gprop,keyword,geo,mes,hits)<span class="op">%&gt;%</span></span>
<span id="cb19-656"><a href="#cb19-656"></a><span class="st">                </span><span class="kw">distinct</span>()<span class="op">%&gt;%</span></span>
<span id="cb19-657"><a href="#cb19-657"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">agno=</span><span class="kw">substr</span>(mes,<span class="dv">1</span>,<span class="dv">4</span>),</span>
<span id="cb19-658"><a href="#cb19-658"></a>                       <span class="dt">mes=</span><span class="kw">substr</span>(mes,<span class="dv">6</span>,<span class="dv">7</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-659"><a href="#cb19-659"></a><span class="st">                </span><span class="kw">group_by</span>(agno,keyword,geo) <span class="op">%&gt;%</span></span>
<span id="cb19-660"><a href="#cb19-660"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">max_hits=</span><span class="kw">max</span>(hits))<span class="op">%&gt;%</span></span>
<span id="cb19-661"><a href="#cb19-661"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">min_hits=</span><span class="dv">0</span>)<span class="op">%&gt;%</span></span>
<span id="cb19-662"><a href="#cb19-662"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rescal=</span><span class="kw">trunc</span>((hits<span class="op">-</span>min_hits)<span class="op">/</span>(max_hits<span class="op">-</span>min_hits)<span class="op">*</span><span class="dv">100</span>))<span class="op">%&gt;%</span></span>
<span id="cb19-663"><a href="#cb19-663"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">hits =</span> <span class="kw">as.numeric</span>(rescal))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-664"><a href="#cb19-664"></a><span class="st">                </span><span class="kw">select</span>(agno,mes,gprop,keyword,geo,hits)<span class="op">%&gt;%</span></span>
<span id="cb19-665"><a href="#cb19-665"></a><span class="st">                </span><span class="kw">distinct</span>()</span>
<span id="cb19-666"><a href="#cb19-666"></a>        </span>
<span id="cb19-667"><a href="#cb19-667"></a>        data_trends=<span class="kw">rbind</span>(data_trends,data)</span>
<span id="cb19-668"><a href="#cb19-668"></a>}</span>
<span id="cb19-669"><a href="#cb19-669"></a></span>
<span id="cb19-670"><a href="#cb19-670"></a><span class="co"># 4.1 Save BBDD  --------------------------------------------------------------</span></span>
<span id="cb19-671"><a href="#cb19-671"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/BID_GH/bbdd_edit/data_rds&quot;</span>)</span>
<span id="cb19-672"><a href="#cb19-672"></a><span class="kw">saveRDS</span>(data_trends,<span class="st">&quot;data_trends.rds&quot;</span>)</span></code></pre></div>
<p>###1.2 Topics Over time 2020{#topics_veinte}</p>
<p>Se replica el procedimiento para el año 2020, cambiando el parámetro ‘time’:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># 1.2   Topics Over Time 2020-----------------------------------------------</span></span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb20-6"><a href="#cb20-6"></a>topics_tbl=<span class="ot">NULL</span></span>
<span id="cb20-7"><a href="#cb20-7"></a></span>
<span id="cb20-8"><a href="#cb20-8"></a>time=<span class="st">&quot;2020-01-01 2020-07-01&quot;</span></span>
<span id="cb20-9"><a href="#cb20-9"></a></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb20-11"><a href="#cb20-11"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb20-12"><a href="#cb20-12"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb20-14"><a href="#cb20-14"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb20-15"><a href="#cb20-15"></a>        </span>
<span id="cb20-16"><a href="#cb20-16"></a>        n_term=<span class="dv">10</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>        top_n_related_topics_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="st">                </span><span class="kw">pluck</span>(<span class="st">&quot;related_topics&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-19"><a href="#cb20-19"></a><span class="st">                </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-20"><a href="#cb20-20"></a><span class="st">                </span><span class="kw">filter</span>(related_topics <span class="op">==</span><span class="st"> &quot;top&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-21"><a href="#cb20-21"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(subject)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="st">                </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="st">                </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="st">                </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-25"><a href="#cb20-25"></a><span class="st">                </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>n_term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-26"><a href="#cb20-26"></a><span class="st">                </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-27"><a href="#cb20-27"></a><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb20-28"><a href="#cb20-28"></a>        </span>
<span id="cb20-29"><a href="#cb20-29"></a>        topics_tbl=<span class="st"> </span><span class="kw">union_all</span>(topics_tbl,top_n_related_topics_tbl)</span>
<span id="cb20-30"><a href="#cb20-30"></a>}</span>
<span id="cb20-31"><a href="#cb20-31"></a></span>
<span id="cb20-32"><a href="#cb20-32"></a>topics_tbl=topics_tbl<span class="op">%&gt;%</span></span>
<span id="cb20-33"><a href="#cb20-33"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb20-34"><a href="#cb20-34"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb20-35"><a href="#cb20-35"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb20-36"><a href="#cb20-36"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,value) <span class="op">%&gt;%</span></span>
<span id="cb20-37"><a href="#cb20-37"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_in=</span><span class="kw">max</span>(interest))<span class="op">%&gt;%</span></span>
<span id="cb20-38"><a href="#cb20-38"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(max_in)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-39"><a href="#cb20-39"></a><span class="st">        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span></span>
<span id="cb20-40"><a href="#cb20-40"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-41"><a href="#cb20-41"></a><span class="st">        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-42"><a href="#cb20-42"></a><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-43"><a href="#cb20-43"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb20-44"><a href="#cb20-44"></a></span>
<span id="cb20-45"><a href="#cb20-45"></a><span class="co"># 1.2.1   Save BBDD  --------------------------------------------------------</span></span>
<span id="cb20-46"><a href="#cb20-46"></a><span class="kw">saveRDS</span>(topics_tbl,<span class="st">&quot;topics_tbl20.rds&quot;</span>)</span>
<span id="cb20-47"><a href="#cb20-47"></a><span class="co"># 1.2.2   Graphic -------------------------------------------------------------</span></span>
<span id="cb20-48"><a href="#cb20-48"></a></span>
<span id="cb20-49"><a href="#cb20-49"></a>topics_tbl =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;topics_tbl20.rds&quot;</span>)</span>
<span id="cb20-50"><a href="#cb20-50"></a></span>
<span id="cb20-51"><a href="#cb20-51"></a></span>
<span id="cb20-52"><a href="#cb20-52"></a>topics=topics_tbl <span class="op">%&gt;%</span></span>
<span id="cb20-53"><a href="#cb20-53"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, interest, <span class="dt">color =</span> keyword)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-54"><a href="#cb20-54"></a><span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> value, <span class="dt">yend =</span> <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb20-55"><a href="#cb20-55"></a><span class="st">        </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb20-56"><a href="#cb20-56"></a><span class="st">        </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb20-57"><a href="#cb20-57"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></span>
<span id="cb20-58"><a href="#cb20-58"></a><span class="st">        </span><span class="kw">theme_tq</span>()<span class="op">+</span></span>
<span id="cb20-59"><a href="#cb20-59"></a><span class="st">        </span><span class="kw">scale_color_tq</span>()<span class="op">+</span></span>
<span id="cb20-60"><a href="#cb20-60"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;2020&quot;</span>)<span class="op">+</span></span>
<span id="cb20-61"><a href="#cb20-61"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb20-62"><a href="#cb20-62"></a></span>
<span id="cb20-63"><a href="#cb20-63"></a><span class="kw">plot</span>(topics)</span>
<span id="cb20-64"><a href="#cb20-64"></a></span>
<span id="cb20-65"><a href="#cb20-65"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb20-66"><a href="#cb20-66"></a></span>
<span id="cb20-67"><a href="#cb20-67"></a><span class="co"># 1.2.3   Queries Over Time 2020-----------------------------------------------</span></span>
<span id="cb20-68"><a href="#cb20-68"></a></span>
<span id="cb20-69"><a href="#cb20-69"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb20-70"><a href="#cb20-70"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb20-71"><a href="#cb20-71"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb20-72"><a href="#cb20-72"></a>topics_tbl=<span class="ot">NULL</span></span>
<span id="cb20-73"><a href="#cb20-73"></a></span>
<span id="cb20-74"><a href="#cb20-74"></a>time=<span class="st">&quot;2020-01-01 2020-07-01&quot;</span></span>
<span id="cb20-75"><a href="#cb20-75"></a></span>
<span id="cb20-76"><a href="#cb20-76"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb20-77"><a href="#cb20-77"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb20-78"><a href="#cb20-78"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb20-79"><a href="#cb20-79"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb20-80"><a href="#cb20-80"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb20-81"><a href="#cb20-81"></a>        </span>
<span id="cb20-82"><a href="#cb20-82"></a>        x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>related_queries)</span>
<span id="cb20-83"><a href="#cb20-83"></a>        </span>
<span id="cb20-84"><a href="#cb20-84"></a>        <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb20-85"><a href="#cb20-85"></a>                n_term=<span class="dv">10</span></span>
<span id="cb20-86"><a href="#cb20-86"></a>                top_n_related_topics_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-87"><a href="#cb20-87"></a><span class="st">                        </span><span class="kw">pluck</span>(<span class="st">&quot;related_queries&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-88"><a href="#cb20-88"></a><span class="st">                        </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-89"><a href="#cb20-89"></a><span class="st">                        </span><span class="kw">filter</span>(related_queries <span class="op">==</span><span class="st"> &quot;top&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-90"><a href="#cb20-90"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(subject)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-91"><a href="#cb20-91"></a><span class="st">                        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-92"><a href="#cb20-92"></a><span class="st">                        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-93"><a href="#cb20-93"></a><span class="st">                        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-94"><a href="#cb20-94"></a><span class="st">                        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>n_term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-95"><a href="#cb20-95"></a><span class="st">                        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-96"><a href="#cb20-96"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb20-97"><a href="#cb20-97"></a>                </span>
<span id="cb20-98"><a href="#cb20-98"></a>                topics_tbl=<span class="st"> </span><span class="kw">union_all</span>(topics_tbl,top_n_related_topics_tbl)</span>
<span id="cb20-99"><a href="#cb20-99"></a>        }</span>
<span id="cb20-100"><a href="#cb20-100"></a>}</span>
<span id="cb20-101"><a href="#cb20-101"></a></span>
<span id="cb20-102"><a href="#cb20-102"></a>queries_tbl=topics_tbl<span class="op">%&gt;%</span></span>
<span id="cb20-103"><a href="#cb20-103"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb20-104"><a href="#cb20-104"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>))<span class="op">%&gt;%</span></span>
<span id="cb20-105"><a href="#cb20-105"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb20-106"><a href="#cb20-106"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,value) <span class="op">%&gt;%</span></span>
<span id="cb20-107"><a href="#cb20-107"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_in=</span><span class="kw">max</span>(interest))<span class="op">%&gt;%</span></span>
<span id="cb20-108"><a href="#cb20-108"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(max_in)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-109"><a href="#cb20-109"></a><span class="st">        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span></span>
<span id="cb20-110"><a href="#cb20-110"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-111"><a href="#cb20-111"></a><span class="st">        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-112"><a href="#cb20-112"></a><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-113"><a href="#cb20-113"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span></code></pre></div>
<p>Para la representación visual, es necesario cambiar se cambia el título modificando el contenido del paréntesis correspondiente a la expresión ‘ggtitle’ como se muestra a continuación:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>topics=topics_tbl <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, interest, <span class="dt">color =</span> keyword)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> value, <span class="dt">yend =</span> <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="st">        </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="st">        </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="st">        </span><span class="kw">theme_tq</span>()<span class="op">+</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="st">        </span><span class="kw">scale_color_tq</span>()<span class="op">+</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;2020&quot;</span>)<span class="op">+</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb21-11"><a href="#cb21-11"></a></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="kw">plot</span>(topics)</span></code></pre></div>
<p><strong>1.2 Related Queries Over Time 2019 - 2020</strong></p>
<p>Los parámetros de la sección <a href="#queries2019">Related Queries Over Time del año 2019</a>, son:</p>
<ul>
<li>‘terminos’: lista de términos de interés para la búsqueda.</li>
<li>‘topics_tbl’: Data Frame cuyo atributo ‘NULL’ implica que se genera sin ningún contenido, y posteriormente se completa secuencialmente, con la información arrojada tras la ejecución de la función ‘for’.</li>
<li>‘time’: Especifica el rango temporal de la búsqueda que en este caso es entre la fecha “2019-01-01” y “2019-07-01”.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>terminos=<span class="kw">c</span>(<span class="st">&quot;Ciberacoso&quot;</span>,<span class="st">&quot;Ciberbullying&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,</span>
<span id="cb22-2"><a href="#cb22-2"></a>           <span class="st">&quot;Violencia Domestica&quot;</span>,<span class="st">&quot;Violencia contra la mujer&quot;</span>,</span>
<span id="cb22-3"><a href="#cb22-3"></a>           <span class="st">&quot;Violence Against Women&quot;</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a>topics_tbl=<span class="ot">NULL</span></span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a>time=<span class="st">&quot;2019-01-01 2019-07-01&quot;</span></span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="cf">for</span> (p <span class="cf">in</span> terminos) {</span>
<span id="cb22-9"><a href="#cb22-9"></a>        search_terms =<span class="st"> </span>p</span>
<span id="cb22-10"><a href="#cb22-10"></a>        gtrends_lst =search_terms <span class="op">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="st">                </span><span class="kw">gtrends</span>(<span class="dt">time =</span> time,</span>
<span id="cb22-12"><a href="#cb22-12"></a>                        <span class="dt">low_search_volume =</span> <span class="ot">TRUE</span>)</span>
<span id="cb22-13"><a href="#cb22-13"></a>        </span>
<span id="cb22-14"><a href="#cb22-14"></a>       x=<span class="kw">unique</span>(gtrends_lst<span class="op">$</span>related_queries)</span>
<span id="cb22-15"><a href="#cb22-15"></a>        </span>
<span id="cb22-16"><a href="#cb22-16"></a>        <span class="cf">if</span> (<span class="kw">is.null</span>(x)<span class="op">==</span><span class="ot">FALSE</span>){</span>
<span id="cb22-17"><a href="#cb22-17"></a>                n_term=<span class="dv">10</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>                top_n_related_topics_tbl =<span class="st"> </span>gtrends_lst <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-19"><a href="#cb22-19"></a><span class="st">                        </span><span class="kw">pluck</span>(<span class="st">&quot;related_queries&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="st">                        </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-21"><a href="#cb22-21"></a><span class="st">                        </span><span class="kw">filter</span>(related_queries <span class="op">==</span><span class="st"> &quot;top&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-22"><a href="#cb22-22"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(subject)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-23"><a href="#cb22-23"></a><span class="st">                        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-24"><a href="#cb22-24"></a><span class="st">                        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-25"><a href="#cb22-25"></a><span class="st">                        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-26"><a href="#cb22-26"></a><span class="st">                        </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span>n_term) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-27"><a href="#cb22-27"></a><span class="st">                        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-28"><a href="#cb22-28"></a><span class="st">                        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fct_reorder</span>(interest))</span>
<span id="cb22-29"><a href="#cb22-29"></a>                </span>
<span id="cb22-30"><a href="#cb22-30"></a>                topics_tbl=<span class="st"> </span><span class="kw">union_all</span>(topics_tbl,top_n_related_topics_tbl)</span>
<span id="cb22-31"><a href="#cb22-31"></a>        }</span>
<span id="cb22-32"><a href="#cb22-32"></a>}</span>
<span id="cb22-33"><a href="#cb22-33"></a></span>
<span id="cb22-34"><a href="#cb22-34"></a>queries_tbl=topics_tbl<span class="op">%&gt;%</span></span>
<span id="cb22-35"><a href="#cb22-35"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Tematica=</span><span class="kw">substr</span>(keyword, <span class="dt">star=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">1</span>))<span class="op">%&gt;%</span></span>
<span id="cb22-36"><a href="#cb22-36"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">keyword=</span><span class="kw">ifelse</span>(Tematica<span class="op">==</span><span class="st">&quot;C&quot;</span>,<span class="st">&quot;Cyberbullying&quot;</span>,<span class="st">&quot;Violencia Doméstica&quot;</span>),</span>
<span id="cb22-37"><a href="#cb22-37"></a>               <span class="dt">value =</span> <span class="kw">stri_trans_general</span>(value, <span class="st">&#39;es&#39;</span>))<span class="op">%&gt;%</span></span>
<span id="cb22-38"><a href="#cb22-38"></a><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>Tematica)<span class="op">%&gt;%</span></span>
<span id="cb22-39"><a href="#cb22-39"></a><span class="st">        </span><span class="kw">group_by</span>(keyword,value) <span class="op">%&gt;%</span></span>
<span id="cb22-40"><a href="#cb22-40"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">max_in=</span><span class="kw">max</span>(interest))<span class="op">%&gt;%</span></span>
<span id="cb22-41"><a href="#cb22-41"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">interest =</span> <span class="kw">as.numeric</span>(max_in)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-42"><a href="#cb22-42"></a><span class="st">        </span><span class="kw">select</span>(keyword,value,interest)<span class="op">%&gt;%</span></span>
<span id="cb22-43"><a href="#cb22-43"></a><span class="st">        </span><span class="kw">group_by</span>(keyword) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-44"><a href="#cb22-44"></a><span class="st">        </span><span class="kw">arrange</span>(<span class="kw">desc</span>(interest))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-45"><a href="#cb22-45"></a><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-46"><a href="#cb22-46"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as_factor</span>(value) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb22-47"><a href="#cb22-47"></a><span class="st">                       </span><span class="kw">fct_reorder</span>(interest))</span></code></pre></div>
<p>Al igual que en <a href="#anexotopics">Topics</a>, no es posible asegurar que debido a factores externos al desarrollo del Script, los resultados puedan variar, es por ello que es importante guardar los resultados cuando estime conveniente con la función ‘saveRDS’, como se realiza a continuación:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">saveRDS</span>(queries_tbl,<span class="st">&quot;queries_tbl19.rds&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co">#El formato RDS se utilizó para comprimir la información y ejecutarla en Rstudio. </span></span></code></pre></div>
<p>Para rescatar el resultado previamente guardado, se ejecuta la función ‘readRDS’:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>queries_tbl =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;queries_tbl19.rds&quot;</span>)</span></code></pre></div>
<p>Por último se ejecuta la representación gráfica, diferenciando el año a través de la expresión ‘ggtitle’ = 2019.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>queries=queries_tbl <span class="op">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, interest, <span class="dt">color =</span> keyword)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> value, <span class="dt">yend =</span> <span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="st">        </span><span class="kw">geom_point</span>()<span class="op">+</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="st">        </span><span class="kw">coord_flip</span>()<span class="op">+</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="st">        </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>keyword, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="st">        </span><span class="kw">theme_tq</span>()<span class="op">+</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="st">        </span><span class="kw">scale_color_tq</span>()<span class="op">+</span></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="st">        </span><span class="kw">ggtitle</span>(<span class="st">&quot;2019&quot;</span>)<span class="op">+</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="st">        </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb25-11"><a href="#cb25-11"></a></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="kw">plot</span>(queries)</span></code></pre></div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
